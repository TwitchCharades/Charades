<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Splashscreen</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <style>
            :root {
                --bg-dark: #111318;
                --bg-card: #18191c;
                --accent: #5865f2;
                --accent-soft: rgba(88, 101, 242, 0.35);
                --text-main: #ffffff;
                --text-muted: #b9bbbe;
                --border-subtle: #202225;
            }

            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }

            body {
                font-family:
                    system-ui,
                    -apple-system,
                    BlinkMacSystemFont,
                    "Segoe UI",
                    sans-serif;
                height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;

                color: var(--text-main);
            }

            .splash-container {
                width: 100%;
                max-width: 480px;
                padding: 32px 24px 24px;
                border-radius: 16px;
                background: linear-gradient(145deg, #15171b, #101217);
                box-shadow:
                    0 18px 45px rgba(0, 0, 0, 0.75),
                    0 0 0 1px rgba(255, 255, 255, 0.03);
                display: flex;
                flex-direction: column;
                gap: 24px;
                position: relative;
                overflow: hidden;
            }

            .splash-container::before {
                content: "";
                position: absolute;
                inset: -40%;
                background:
                    radial-gradient(circle at 0 0, rgba(88, 101, 242, 0.3), transparent 55%),
                    radial-gradient(circle at 100% 100%, rgba(88, 101, 242, 0.15), transparent 60%);
                opacity: 0.5;
                pointer-events: none;
            }

            .splash-header {
                display: flex;
                align-items: center;
                gap: 16px;
                position: relative;
                z-index: 1;
            }

            .logo-circle {
                height: 52px;
                width: 52px;
                display: flex;
                align-items: center;
                justify-content: center;
                transform: translateY(5px);
            }

            .logo-inner {
                height: 52px;
                width: 52px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .logo-inner img {
                width: 52px;
                height: 52px;
                display: block;
            }

            .header-text {
                display: flex;
                flex-direction: column;
                gap: 4px;
            }

            .header-title {
                font-size: 1.2rem;
                font-weight: 700;
            }

            .header-subtitle {
                font-size: 0.9rem;
                color: var(--text-muted);
                transition: opacity 0.5s ease-in-out;
            }

            .header-subtitle.fade-out {
                opacity: 0;
            }

            .loading-section {
                display: flex;
                flex-direction: column;
                gap: 12px;
                position: relative;
                z-index: 1;
            }

            .loading-label {
                font-size: 0.85rem;
                text-transform: uppercase;
                letter-spacing: 0.12em;
                color: var(--text-muted);
            }

            .progress-track {
                width: 100%;
                height: 6px;
                border-radius: 999px;
                background: #202225;
                overflow: hidden;
                position: relative;
            }

            .progress-bar {
                height: 100%;
                width: 40%;
                background: linear-gradient(90deg, #7983ff, #5865f2);
                border-radius: 999px;
                position: absolute;
                left: -40%;
                animation: progress-slide 1.6s ease-in-out infinite;
            }

            @keyframes progress-slide {
                0% {
                    left: -40%;
                    width: 20%;
                }
                50% {
                    left: 25%;
                    width: 50%;
                }
                100% {
                    left: 100%;
                    width: 30%;
                }
            }

            .loading-meta {
                display: flex;
                justify-content: space-between;
                align-items: center;
                font-size: 0.78rem;
                color: var(--text-muted);
            }

            .dots {
                display: inline-flex;
                gap: 4px;
                align-items: center;
            }

            .dot {
                width: 6px;
                height: 6px;
                border-radius: 999px;
                background: var(--accent-soft);
                animation: pulse 1.4s infinite ease-in-out;
            }

            .dot:nth-child(2) {
                animation-delay: 0.15s;
            }

            .dot:nth-child(3) {
                animation-delay: 0.3s;
            }

            @keyframes pulse {
                0%,
                80%,
                100% {
                    transform: scale(0.8);
                    opacity: 0.5;
                }
                40% {
                    transform: scale(1);
                    opacity: 1;
                }
            }

            .footnote {
                font-size: 0.75rem;
                color: var(--text-muted);
                opacity: 0.85;
                position: relative;
                z-index: 1;
                display: flex;
                justify-content: space-between;
                gap: 8px;
                flex-wrap: wrap;
            }

            .pill {
                padding: 4px 10px;
                border-radius: 999px;
                background-color: #202225;
                border: 1px solid var(--border-subtle);
                font-size: 0.7rem;
                text-transform: uppercase;
                letter-spacing: 0.1em;
                color: var(--text-muted);
            }

            @media (max-width: 480px) {
                .splash-container {
                    margin: 0 16px;
                    padding: 24px 18px 18px;
                }
            }
        </style>
    </head>
    <body>
        <div class="splash-container">
            <div class="splash-header">
                <div class="logo-circle">
                    <div class="logo-inner">
                        <img src="icon_512.png" alt="Twitch Charades Logo" />
                    </div>
                </div>
                <div class="header-text">
                    <div class="header-title">Twitch Charades</div>
                    <div class="header-subtitle" id="subtitle-text">
                        Teaching hamsters to read chat…
                    </div>
                </div>
            </div>

            <div class="loading-section">
                <div class="loading-label">Loading</div>

                <div class="progress-track">
                    <div class="progress-bar"></div>
                </div>

                <div class="loading-meta">
                    <span id="status-text">Checking microservice health…</span>
                    <span class="dots">
                        <span class="dot"></span>
                        <span class="dot"></span>
                        <span class="dot"></span>
                    </span>
                </div>
            </div>

            <div class="footnote">
                <span>Made with ❤️ by ILostMyMedic</span>
                <span class="pill" id="status-pill">Checking...</span>
            </div>
        </div>

        <script>
            // Funny subtitle messages
            const funnyMessages = [
                "Teaching hamsters to read chat…",
                "Convincing pixels to cooperate…",
                "Bribing the server hamsters…",
                "Downloading more RAM…",
                "Asking Twitch nicely…",
                "Waking up the bots…",
                "Polishing the pixels…",
                "Loading QueenManda's forehead…",
                "Searching for Lyssaurora's height…",
                "Finding the perfect gif…",
                "Looking for Clancy's egirls…",
            ];

            let subtitleInterval = null;
            let shuffledMessages = [];
            let currentIndex = 0;

            // Fisher-Yates shuffle algorithm
            function shuffleArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            }

            function setNextSubtitle() {
                const subtitleElement = document.getElementById("subtitle-text");
                if (subtitleElement) {
                    // Fade out
                    subtitleElement.classList.add("fade-out");

                    // Wait for fade out, then change text and fade in
                    setTimeout(() => {
                        subtitleElement.textContent = shuffledMessages[currentIndex];
                        subtitleElement.classList.remove("fade-out");

                        // Move to next message
                        currentIndex++;

                        // If we've gone through all messages, reshuffle and start over
                        if (currentIndex >= shuffledMessages.length) {
                            shuffledMessages = shuffleArray(funnyMessages);
                            currentIndex = 0;
                        }
                    }, 500); // Match CSS transition duration
                }
            }

            function startSubtitleRotation() {
                // Shuffle the messages
                shuffledMessages = shuffleArray(funnyMessages);

                // Find a random starting position
                currentIndex = Math.floor(Math.random() * shuffledMessages.length);

                // Set the initial text to the random starting message
                const subtitleElement = document.getElementById("subtitle-text");
                if (subtitleElement) {
                    subtitleElement.textContent = shuffledMessages[currentIndex];
                    currentIndex++;

                    // If we've already reached the end, reshuffle
                    if (currentIndex >= shuffledMessages.length) {
                        shuffledMessages = shuffleArray(funnyMessages);
                        currentIndex = 0;
                    }
                }

                // Start rotating after the first interval
                subtitleInterval = setInterval(setNextSubtitle, 5000);
            }

            function stopSubtitleRotation() {
                if (subtitleInterval) {
                    clearInterval(subtitleInterval);
                    subtitleInterval = null;
                }
            }

            // Start rotation when page loads
            startSubtitleRotation();

            // Wait for DOM to be ready
            function initHealthMonitoring() {
                // Health status updates from main process
                if (window.electronAPI && window.electronAPI.onHealthStatus) {
                    window.electronAPI.onHealthStatus(data => {
                        const statusText = document.getElementById("status-text");
                        const statusPill = document.getElementById("status-pill");
                        const progressBar = document.querySelector(".progress-bar");

                        if (statusText) {
                            statusText.textContent = data.message;
                        }

                        if (statusPill) {
                            if (data.status === "online") {
                                statusPill.textContent = "✓ Connected";
                                statusPill.style.background =
                                    "linear-gradient(135deg, #43e97b, #38f9d7)";
                                statusPill.style.color = "#111318";
                                statusPill.style.borderColor = "#43e97b";
                            } else if (data.status === "offline" || data.error) {
                                statusPill.textContent = "✗ Offline";
                                statusPill.style.background =
                                    "linear-gradient(135deg, #fa709a, #fee140)";
                                statusPill.style.color = "#111318";
                                statusPill.style.borderColor = "#fa709a";
                                if (progressBar) {
                                    progressBar.style.animation = "none";
                                    progressBar.style.background =
                                        "linear-gradient(90deg, #fa709a, #fee140)";
                                }
                            } else if (data.status === "checking") {
                                statusPill.textContent = `Connecting ${data.attempts}/${data.maxRetries}`;
                            }
                        }
                    });
                }
            }

            // Also provide direct health check capability from splash
            async function verifyHealth() {
                if (window.electronAPI && window.electronAPI.checkHealth) {
                    const result = await window.electronAPI.checkHealth();
                    return result;
                }
                return { ok: false, error: "electronAPI not available" };
            }

            // Make it available globally for debugging
            window.verifyHealth = verifyHealth;

            // Initialize when DOM is ready
            if (document.readyState === "loading") {
                document.addEventListener("DOMContentLoaded", initHealthMonitoring);
            } else {
                initHealthMonitoring();
            }
        </script>
    </body>
</html>
